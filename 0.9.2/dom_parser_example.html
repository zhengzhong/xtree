<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xtree: Parsing XML into a DOM Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">xtree&#160;<span id="projectnumber">0.9.2</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">xtree - a C++ wrapper for libxml2</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Parsing XML into a DOM Document </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>Imagine that we have the following XML:</p>
<p><div class="fragment"><pre class="fragment">    <span class="comment">// dom_parse_string_example: xml-string-begin</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span>* EXAMPLE_XML_STRING =
        <span class="stringliteral">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;&quot;</span>
        <span class="stringliteral">&quot;&lt;?processing-instructions dummy-pi?&gt;&quot;</span>
        <span class="stringliteral">&quot;&lt;!--this is a comment--&gt;&quot;</span>
        <span class="stringliteral">&quot;&lt;root&gt;this is the content of this element&lt;/root&gt;&quot;</span>
    ;
    <span class="comment">// dom_parse_string_example: xml-string-end</span>
</pre></div></p>
<p>To parse the XML string into a DOM document object, use <a class="el" href="namespacextree.html#aa15f48fec8d7eda6bd2becfd24798748" title="Parses an XML string to a document object.">xtree::parse_string</a> (alternatively, you can use the function <a class="el" href="namespacextree.html#a4324cdfbe85527ce6466ba67699ea6e1" title="Parses an XML file to a document object.">xtree::parse_file</a> to parse an XML file):</p>
<p><div class="fragment"><pre class="fragment">        <span class="comment">// dom_parse_string_example: parse-string-begin</span>
        std::auto_ptr&lt;xtree::document&gt; doc(<a class="code" href="namespacextree.html#aa15f48fec8d7eda6bd2becfd24798748" title="Parses an XML string to a document object.">xtree::parse_string</a>(EXAMPLE_XML_STRING));
        <span class="comment">// dom_parse_string_example: parse-string-end</span>
</pre></div></p>
<p>Note that the function <a class="el" href="namespacextree.html#aa15f48fec8d7eda6bd2becfd24798748" title="Parses an XML string to a document object.">xtree::parse_string</a> returns a pointer to the <a class="el" href="classxtree_1_1document.html" title="This class represents an XML document.">xtree::document</a> object. It is up to the caller to free the pointer. So it is a good practice to put the pointer into a smart pointer (std::auto_ptr&lt;xtree::document&gt; in the example).</p>
<p>Then you can use the <a class="el" href="classxtree_1_1document.html" title="This class represents an XML document.">xtree::document</a> object to access information about the XML document:</p>
<p><div class="fragment"><pre class="fragment">        <span class="comment">// dom_parse_string_example: access-document-info-begin</span>
        std::cout &lt;&lt; <span class="stringliteral">&quot;XML document &quot;</span>
                  &lt;&lt; <span class="stringliteral">&quot;(version &quot;</span> &lt;&lt; doc-&gt;version() &lt;&lt; <span class="stringliteral">&quot;, encoding: &quot;</span> &lt;&lt; doc-&gt;encoding() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
                  &lt;&lt; <span class="stringliteral">&quot;contains &quot;</span> &lt;&lt; doc-&gt;children().size() &lt;&lt; <span class="stringliteral">&quot; children.\n&quot;</span>;
        <span class="comment">// dom_parse_string_example: access-document-info-end</span>
</pre></div></p>
<p>In the above XML string, the document contains three child nodes: a processing instruction, a comment and a subelement. You can access the document's children like this:</p>
<p><div class="fragment"><pre class="fragment">        <span class="comment">// dom_parse_string_example: access-children-begin</span>
        <a class="code" href="classxtree_1_1child__node__list.html">xtree::child_node_list</a>&amp; children = doc-&gt;children();
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
        <span class="keywordflow">for</span> (<a class="code" href="classxtree_1_1basic__node__iterator.html">xtree::child_iterator</a> i = children.<a class="code" href="classxtree_1_1child__node__list.html#a3665dec842e15ed00b07be17bcb581fe">begin</a>(); i != children.<a class="code" href="classxtree_1_1child__node__list.html#a6b0c1894afc24a8b33dc66b750cefb7c">end</a>(); ++i, ++index)
        {
            std::cout &lt;&lt; <span class="stringliteral">&quot;content of child #&quot;</span> &lt;&lt; index
                      &lt;&lt; <span class="stringliteral">&quot; (type ID: &quot;</span> &lt;&lt; i-&gt;type() &lt;&lt; <span class="stringliteral">&quot;) : &quot;</span>
                      &lt;&lt; i-&gt;content() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
        <span class="comment">// dom_parse_string_example: access-children-end</span>
</pre></div></p>
<p>You can also get the root element directly from the document:</p>
<p><div class="fragment"><pre class="fragment">        <span class="comment">// dom_parse_string_example: access-root-begin</span>
        <a class="code" href="classxtree_1_1basic__node__ptr.html">xtree::element_ptr</a> root = doc-&gt;root();
        std::cout &lt;&lt; <span class="stringliteral">&quot;root element: &quot;</span> &lt;&lt; root-&gt;name() &lt;&lt; <span class="stringliteral">&quot;, content: &quot;</span> &lt;&lt; root-&gt;content() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <span class="comment">// dom_parse_string_example: access-root-end</span>
</pre></div></p>
<p>Note that the returned <a class="el" href="namespacextree.html#aa3776c4ed2a2ac8fb61fc1b254b0a6c2">xtree::element_ptr</a> is a pointer to the root element. The resource of this pointer is managed by the document object itself. It will be freed when the document is freed. You do not need to delete it (in fact, you cannot delete it).</p>
<p>If you pass a non-well-formed XML string to <a class="el" href="namespacextree.html#aa15f48fec8d7eda6bd2becfd24798748" title="Parses an XML string to a document object.">xtree::parse_string</a>, you'll get an <a class="el" href="classxtree_1_1dom__error.html" title="This class represents an error related to XML DOM.">xtree::dom_error</a> exception. Following code snippet tests various non-well-formed XML strings:</p>
<p><div class="fragment"><pre class="fragment">    <span class="comment">// dom_parse_bad_xml_example: xml-string-begin</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span>* BAD_XML_STRINGS[] = {
        <span class="stringliteral">&quot;&lt;root&gt;&lt;bad element/&gt;&lt;/root&gt;&quot;</span>,  <span class="comment">// invalid element tag.</span>
        <span class="stringliteral">&quot;&lt;root a=&#39;A1&#39; b=&#39;B&#39; a=&#39;A2&#39;/&gt;&quot;</span>,  <span class="comment">// attributes with the same name.</span>
        <span class="stringliteral">&quot;&lt;root&gt;hello&quot;</span>,                  <span class="comment">// unclosed tag.</span>
        <span class="stringliteral">&quot;&lt;root&gt;hello&lt;/Root&gt;&quot;</span>,           <span class="comment">// unmatched begin/close tag.</span>
    };
    <span class="comment">// dom_parse_bad_xml_example: xml-string-end</span>
</pre></div></p>
<p>Trying to parsing such strings will raise exceptions:</p>
<p><div class="fragment"><pre class="fragment">    <span class="comment">// dom_parse_bad_xml_example: parse-string-begin</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <span class="keyword">sizeof</span>(BAD_XML_STRINGS) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <span class="keywordtype">char</span>*); ++i)
    {
        <span class="keywordflow">try</span>
        {
            std::auto_ptr&lt;xtree::document&gt; doc(<a class="code" href="namespacextree.html#aa15f48fec8d7eda6bd2becfd24798748" title="Parses an XML string to a document object.">xtree::parse_string</a>(BAD_XML_STRINGS[i]));
            std::cerr &lt;&lt; <span class="stringliteral">&quot;error: expected xtree::dom_error but got nothing.\n&quot;</span>;
        }
        <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classxtree_1_1dom__error.html" title="This class represents an error related to XML DOM.">xtree::dom_error</a>&amp; ex)
        {
            std::cout &lt;&lt; <span class="stringliteral">&quot;got expected xtree::dom_error: &quot;</span> &lt;&lt; ex.<a class="code" href="classxtree_1_1dom__error.html#a997b67fe723a90e46a5ea5c3be988487">what</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
    }
    <span class="comment">// dom_parse_bad_xml_example: parse-string-end</span>
</pre></div></p>
<h2><a class="anchor" id="example_source"></a>
Full source code of this example:</h2>
<div class="fragment"><pre class="fragment"><span class="comment">//</span>
<span class="comment">// Created by ZHENG Zhong on 2011-06-08.</span>
<span class="comment">//</span>

<span class="preprocessor">#ifndef XTREE_DOM_PARSER_EXAMPLE_HPP_20110608__</span>
<span class="preprocessor"></span><span class="preprocessor">#define XTREE_DOM_PARSER_EXAMPLE_HPP_20110608__</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;xtree/xtree.hpp&gt;</span>

<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;memory&gt;</span>
<span class="preprocessor">#include &lt;string&gt;</span>


<span class="keywordtype">void</span> dom_parse_string_example()
{
    <span class="comment">// dom_parse_string_example: xml-string-begin</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span>* EXAMPLE_XML_STRING =
        <span class="stringliteral">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;&quot;</span>
        <span class="stringliteral">&quot;&lt;?processing-instructions dummy-pi?&gt;&quot;</span>
        <span class="stringliteral">&quot;&lt;!--this is a comment--&gt;&quot;</span>
        <span class="stringliteral">&quot;&lt;root&gt;this is the content of this element&lt;/root&gt;&quot;</span>
    ;
    <span class="comment">// dom_parse_string_example: xml-string-end</span>

    <span class="keywordflow">try</span>
    {
        <span class="comment">// dom_parse_string_example: parse-string-begin</span>
        std::auto_ptr&lt;xtree::document&gt; doc(<a class="code" href="namespacextree.html#aa15f48fec8d7eda6bd2becfd24798748" title="Parses an XML string to a document object.">xtree::parse_string</a>(EXAMPLE_XML_STRING));
        <span class="comment">// dom_parse_string_example: parse-string-end</span>

        <span class="comment">// dom_parse_string_example: access-document-info-begin</span>
        std::cout &lt;&lt; <span class="stringliteral">&quot;XML document &quot;</span>
                  &lt;&lt; <span class="stringliteral">&quot;(version &quot;</span> &lt;&lt; doc-&gt;version() &lt;&lt; <span class="stringliteral">&quot;, encoding: &quot;</span> &lt;&lt; doc-&gt;encoding() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
                  &lt;&lt; <span class="stringliteral">&quot;contains &quot;</span> &lt;&lt; doc-&gt;children().size() &lt;&lt; <span class="stringliteral">&quot; children.\n&quot;</span>;
        <span class="comment">// dom_parse_string_example: access-document-info-end</span>

        <span class="comment">// dom_parse_string_example: access-children-begin</span>
        <a class="code" href="classxtree_1_1child__node__list.html">xtree::child_node_list</a>&amp; children = doc-&gt;children();
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
        <span class="keywordflow">for</span> (<a class="code" href="classxtree_1_1basic__node__iterator.html">xtree::child_iterator</a> i = children.<a class="code" href="classxtree_1_1child__node__list.html#a3665dec842e15ed00b07be17bcb581fe">begin</a>(); i != children.<a class="code" href="classxtree_1_1child__node__list.html#a6b0c1894afc24a8b33dc66b750cefb7c">end</a>(); ++i, ++index)
        {
            std::cout &lt;&lt; <span class="stringliteral">&quot;content of child #&quot;</span> &lt;&lt; index
                      &lt;&lt; <span class="stringliteral">&quot; (type ID: &quot;</span> &lt;&lt; i-&gt;type() &lt;&lt; <span class="stringliteral">&quot;) : &quot;</span>
                      &lt;&lt; i-&gt;content() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
        <span class="comment">// dom_parse_string_example: access-children-end</span>

        <span class="comment">// dom_parse_string_example: access-root-begin</span>
        <a class="code" href="classxtree_1_1basic__node__ptr.html">xtree::element_ptr</a> root = doc-&gt;root();
        std::cout &lt;&lt; <span class="stringliteral">&quot;root element: &quot;</span> &lt;&lt; root-&gt;name() &lt;&lt; <span class="stringliteral">&quot;, content: &quot;</span> &lt;&lt; root-&gt;content() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <span class="comment">// dom_parse_string_example: access-root-end</span>
    }
    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classxtree_1_1dom__error.html" title="This class represents an error related to XML DOM.">xtree::dom_error</a>&amp; ex)
    {
        std::cout &lt;&lt; <span class="stringliteral">&quot;DOM error: &quot;</span> &lt;&lt; ex.<a class="code" href="classxtree_1_1dom__error.html#a997b67fe723a90e46a5ea5c3be988487">what</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    }
}

<span class="comment"></span>
<span class="comment">///////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"></span>

<span class="keywordtype">void</span> dom_parse_bad_xml_example()
{
    <span class="comment">// dom_parse_bad_xml_example: xml-string-begin</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span>* BAD_XML_STRINGS[] = {
        <span class="stringliteral">&quot;&lt;root&gt;&lt;bad element/&gt;&lt;/root&gt;&quot;</span>,  <span class="comment">// invalid element tag.</span>
        <span class="stringliteral">&quot;&lt;root a=&#39;A1&#39; b=&#39;B&#39; a=&#39;A2&#39;/&gt;&quot;</span>,  <span class="comment">// attributes with the same name.</span>
        <span class="stringliteral">&quot;&lt;root&gt;hello&quot;</span>,                  <span class="comment">// unclosed tag.</span>
        <span class="stringliteral">&quot;&lt;root&gt;hello&lt;/Root&gt;&quot;</span>,           <span class="comment">// unmatched begin/close tag.</span>
    };
    <span class="comment">// dom_parse_bad_xml_example: xml-string-end</span>

    <span class="comment">// dom_parse_bad_xml_example: parse-string-begin</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <span class="keyword">sizeof</span>(BAD_XML_STRINGS) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <span class="keywordtype">char</span>*); ++i)
    {
        <span class="keywordflow">try</span>
        {
            std::auto_ptr&lt;xtree::document&gt; doc(<a class="code" href="namespacextree.html#aa15f48fec8d7eda6bd2becfd24798748" title="Parses an XML string to a document object.">xtree::parse_string</a>(BAD_XML_STRINGS[i]));
            std::cerr &lt;&lt; <span class="stringliteral">&quot;error: expected xtree::dom_error but got nothing.\n&quot;</span>;
        }
        <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classxtree_1_1dom__error.html" title="This class represents an error related to XML DOM.">xtree::dom_error</a>&amp; ex)
        {
            std::cout &lt;&lt; <span class="stringliteral">&quot;got expected xtree::dom_error: &quot;</span> &lt;&lt; ex.<a class="code" href="classxtree_1_1dom__error.html#a997b67fe723a90e46a5ea5c3be988487">what</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
    }
    <span class="comment">// dom_parse_bad_xml_example: parse-string-end</span>
}


<span class="preprocessor">#endif  // XTREE_DOM_PARSER_EXAMPLE_HPP_20110608__</span>
<span class="preprocessor"></span>
</pre></div> </div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/>
<address class="footer">
  <small>
    xtree 0.9.2 API Documentations
    &bull;
    Copyright (C) 2008-2011 <a href="http://www.zhengzhong.net/">ZHENG Zhong</a>
    &bull;
    Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4
  </small>
</address>
</body>
</html>
